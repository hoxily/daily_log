2014-03-03 working log

今早汤军义问我一个问题，国家指导报最早是从哪里抓取的。我记不住，但是从tasks.config.xml的备份文件里面可能可以看出来。
你要想知道最早是从哪里抓的报文，可以看一下tasks.config.xml的备份文件。在 \\10.125.1.119\GistarServer\TransBase

从这个问题里面是否可以看出来一个需求？抓取服务的运行维护需要详细的维护日志，记下每个任务的添加日期、修改日期等信息。


todolist
1.修改原先的预处理程序，换成传输服务来生成xml数据。
1.过程图展示。
5.给Catalog数据库增加旧自动站ENJ文件条目。
OK
6.给查询字符串增加一个timeNearest参数，用于查询最接近timeNearest的数据。
7.增加解码时输入报文文件为空时更加准确的log描述输出。
OK
8.土壤水分更换新地址。
OK（更换新网址，调整Time字段时间解析模板）
9.地面气象资料（SJK）归档历史资料入库。
10.国家指导报数据源调整。
OK

VSS源码库例行维护
[10:26:33] zjy@gistar.com.cn: 检查下自己的源代码管理器，看下是否有使用\\10.33.250.5\vssroot 这个源代码库下的文件，如果有的话，请在今天下班前，都退出且CheckIn有关项目，VSS需要处理下。

Gistar无线网络挂了。

problem:
1. 江苏土壤水份Web页提供的数据中，第一个站（海门2）的站号为“none”，这会导致入库时以"none"为站号插入数据库表中；
2. 江苏土壤水份Web页提供的数据中，站点 58038（沭阳）提供的数据只有站号、站名、经度、纬度、海拔高度，其他字段都为“none”，因此时间字段按照模板'yyyy/MM/dd HH:mm:ss'解析失败。
[11:04:05] 敏 杨: ||58038|沭阳 |DZN1型自动土壤水分观|118.784|34.0964|8.8|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none|none||
[11:20:07] 敏 杨: 由于这个站的Time字段空掉了，导致插入出现异常。最终导致整个报文件其他数据也插入失败。
[11:25:31] 敏 杨: 插入出错:异常:SqlException
内容 System.Data.SqlClient.SqlException (0x80131904): 从 varchar 数据类型到 datetime 数据类型的转换产生一个超出范围的值。

临时解决方案：
由于C#中default(DateTime)返回的时间为 0001/01/01 00:00:00，所以才会出现“从 varchar 数据类型到 datetime 数据类型的转换产生一个超出范围的值。”的错误。
因此可以调整数据库表Time字段类型为datetime2，这样的话，就支持0001/01/01 00：00：00到 9999/12/31 23:59:59的范围了。
如果站号为none的站点只有一个的话，那么海门2这个站的数据是没有问题地保存下来了。否则就会无法区分了。

错误的本质：
理应让解码器忽略这种无效的数据。也就不会影响一下步入库了。


马总，地面气象资料归档历史记录存入结构相同的新表，还是原来的表？
[15:09:19] 荣 马: 新表，新库
[15:09:22] 荣 马: 历史库
