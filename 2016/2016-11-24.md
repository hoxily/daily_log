工作记录2016-11-24

## 复杂的更新处理流程的缘由
对于需要下载大量资源的更新，简单地清空数据库，再往里面加的做法不合适。
关键在于更新随时都可能会被中断（你应该看得到更新界面上那红底白字的四个大字——中断更新），而我们却又需要保证魔镜尽可能可用。
由于某种未知的原因，没有使用事务来控制。
这就不得不实行一种复杂的更新处理流程。

## 差异增量更新
设更新前现有的内容为集合O，后台最新返回的数据为N，
令 I = O ∩ N，于是

- (O - I)就是需要剔除的项；
- (N - I)就是需要新增的项；
- I本身已经在本地数据库中；

按照以上的列举的顺序来处理，即可确保处理过程中，至少有I集合的内容可用。

这就是代码为什么要这样写的理由。

----

如果不重置UIPanel的clipRange 和 localPosition，会造成一个问题。比如第一次加载了100条数据，用户拖动着滚动到另一处边缘。第二次只加载了10条数据。这时会出现DragPanelContents 在clipRange之外的情况。

发现一个很恶心的情况，如果不推迟UITable 的 RePosition 操作，那么会偏掉。