2018-02-06

强行打断动画可能会有问题。保险的做法是等待动画执行完毕再进行同步。

由于协议里缺少数据，无法恢复吃、碰、杠的朝向，所以先实现弃牌的恢复吧。
看了半天的代码，发现一个很严重的问题。除了每个玩家有自己的弃牌集合，还存在一个总的弃牌集合。这个总的弃牌集合主要是用于定位弃牌指针。协议里遗漏了这个总的弃牌集合。光靠各个玩家自己的弃牌小集合无法还原出总的弃牌顺序。实际上，吃、碰、杠仅仅对最后一张打出的牌操作，所以这个总弃牌集合并无必要，仅需要指出最近一次打出的牌（哪个玩家打出的哪张牌）。

王斌收到了app store 的第2次审核结果，说还是ipv6通不过。可是明明已经按照官方的推荐搭建测试wifi环境，测试中已能连上服务器。估计是http接口访问超时时间设置得太短，同时从美国访问中国的服务器延迟太高导致。

objective-c 里的 NSString 的 utf8string方法和cStringUsingEncoding方法返回的字符串生命周期很短，如果跨函数的话，需要自行复制，不如使用getCString方法，提供一个buffer存起来。之前是一直是用const char *的指针指向一个NSString内部或者临时的内存区。函数结束后NSString释放掉了，但是const char*的指针依然指向那里，而且不是NULL。而UnitySendMessage方法在遇到这个瞎指向的指针后，给C#返回了一个空字符串。让人误以为一直没有传进来值。