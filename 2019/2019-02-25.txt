2019-02-25

周末两天忙着搬家。滨兴小区的租房没有按合同约定租满，押金不退。交了一个月的房租，但是只住了半个月。合计损失2100元左右。
搬到了公司附近的望月公寓桂花苑15幢2单元201室4号房间。一室一厅，相比之前大很多。有阳台，朝南。南北通风。实测温湿度分别为12摄氏度和64%相对湿度。
之前住的人还没有完全搬走，今早凌晨0点多才赶到。他说是今天白天收拾东西。

----

慢慢走步行到公司大概需要20分钟左右。

----

在标准光照模型中，使用环境光的部分来模拟间接光照。环境光是一个全局变量，即场景中的所有物体都使用这个环境光。

c_ambient = g_ambient;

漫反射光照是用于对那些物体表面随机散射到各个方向的辐射度进行建模的。在漫反射中，视角的位置是不重要的，因为反射是完全随机的，因此可以认为在任何方向上的分布都是一样的。但是入射光线的角度很重要。

漫反射光照符合兰伯特定律（Lambert's law）：反射光线的强度与表面法线和光源方向之间夹角的余弦值成正比。与视角位置无关。

c_diffuse = (c_light · m_diffuse) * max(0, n · I);

需要防止法线与光源方向点乘的结果为负值，所以使用max函数将其截取到0；

这里的高光反射是一种经验模型，并不完全符合真实世界中的高光反射现象。用于计算那些沿着完全镜面反射方向被反射的光线，让物体看起来是有光泽的。

书中的向量符号上方的^符号是指该向量的单位向量的含义。

计算高光反射需要的信息有：表面法线 n，视角方向 v，光源方向 I，反射方向 r。假设这些矢量都是单位矢量，那么反射方向 r 可以由表面法线和光源方向计算得出：
r = 2(n·I)n - I （做辅助线：r + I构成的菱形，以及连接r与I的终点……，参考 https://www.cnblogs.com/graphics/archive/2013/02/21/2920627.html 提到的方法二，文章中的光源矢量是从光源指向入射点，所以整个公式的正负号反向。）

使用Phong模型来计算高光反射部分：
c_specular = (c_light · m_specular)pow(max(0, v · r), m_gloss);

其中的m_gloss是材质的光泽度，也被称为反光度（shininess）。用于控制高光区域的亮点有多宽，m_gloss越大，亮点就越小。
m_specular是材质的高光反射颜色，用于控制该材质对于高光反射的强度和颜色。
c_light是光源的颜色和强度。
这里使用max函数来防止v·r的结果为负数。

Blinn模型的基本思想是避免计算反射方向r。因此引入了一个新的矢量h，h的定义为：
h = (v + I) / |v + I|;
然后，使用n和h之间的夹角进行计算，而非v与r之间的夹角。
c_specular = (c_light · m_specular)pow(max(0, n · h), m_gloss);

这两种光照模型都是经验模型。不应认为Blinn模型是对Phong模型的近似。

在片元着色器中计算光照，被称为逐像素光照（per-pixel lighting);
在顶点着色器中计算光照，被称为逐顶点光照（per-vetex lighting）；

凹凸贴图是纹理的一种应用，它主要用来实现类似砖块、墙体的那种凹凸不平的效果，相较于一般的纹理映射，它并不是通过纹理映射来改变材质本身的颜色，而是改变或扰动其法线的方向，而法线的方向被用在光线模型中，改变法线的方向就可以影响物体表面光照的明暗效果。因此，凹凸贴图实际上是一种欺骗式的手段，它并没有改变顶点的位置，让物体本身的模型变得凹凸不平，而是影响用户的视觉效果，让用户以为模型是凹凸不平的。凹凸贴图的实现只需要2个三角形，而不是用户误以为的复杂的模型。
凹凸贴图（bump mapping）的实现方法有多种，常见的3种方法如下：
1. 法线贴图（normal mapping);
2. 视差贴图（parallax mapping）;
3. 浮雕贴图（relief mapping）;

Blinn-Phong光照模型的局限性。
1.无法表现菲涅耳反射（Fresnel reflection）这种物理现象。
2.Blinn-Phong模型是各向同性的（isotropic），当固定视角和光源方向旋转表面时，反射不会发生任何改变。但是有些表面是具有各向异性（anisotropic）的反射性质，例如拉丝金属、毛发等。

----

拿着书上最简单的diffuse shader，运行结果是黑色。但是Inspector面板的预览是正常的。找半天，最后发现Light物体的disable掉了。