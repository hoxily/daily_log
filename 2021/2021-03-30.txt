2021年03月30日，星期二，杭州

找到昨晚上传99MiB的JSON数据，导致服务器报500错误的原因了。在廓型库里，添加印花，然后点击保存，这时不仅会保存UserProduct数据，还会保存SCR（style3d cloud render，云渲染）协议定义的必要数据，见POST的JSON的scr_json字段。而对于印花来说，为了云渲染需要将印花的geometry数据完整定义出来，而不能像平台那样，基于cloth基础数据，再加上定位点、Shader等等渲染出一个印花来。原因是云渲染使用的VRAY渲染器，要求的输入数据决定了必需提供完整geometry网格。所以Lt3D.getSrcJson函数，就会将geometry数据转换成co数据，直接以base64编码格式嵌入到这个超大的JSON串里面。另一个造成数据量大的因素则是，原始模型的版片本来就很多，印花又设置了XY循环，并且开启了应用到面料，相当于Cloth上每一块版片都对应一个印花，而每一个印花都包含有一个超大的base64字符串。从而造成点击保存时，生成的JSON超大，上传到服务器时出错了。

我发现预乘Alpha格式不单能解决半透明图案不规则边缘的黑边问题。而且还能决解 texture2DDecal{None|X|Y} 函数里的默认borderColor值混入边缘平滑处理结果里，产生的4个边界的白边。原因就在于，这3个函数为了平滑图案的四个边界，引入了(1,1,1,0)的borderColor，使用了mix函数来做插值。这就正好是今天ppt分享的两颜色线性插值，混入了alpha分量为0的颜色的RGB值。
但是一旦使用预乘alpha模式，mix的结果会进行unpremultiply操作，从而(0,0,0,0)的borderColor完全不会对texture2D采样出的纹理颜色造成影响。

这是个意外的结果。虽然之前磊哥和雷哥已经修掉了这个bug，不太那么明显。但是在特殊构造的数据与背景面料下，为了平滑4个边界所产生的白边还是可以观察到的。
