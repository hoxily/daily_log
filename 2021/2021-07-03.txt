2021年07月03日，星期六，杭州

这周好像只有星期一去了一次游泳馆。其他时间都是下雨。今天早上也是下雨，但是并不大。穿着雨衣就去了。
感觉良好。并没有出现不良反应。也没有什么休力不足的虚弱现象。

早上的时候，整理了一下 mov eax, fs:30h 这个汇编代码。
其实是在操作PEB结构，见 winternl.h 。MSDN官网上有PEB结构的说明。
上次其实已经看到相关的说明文档。但是感觉就是没有看进去。不知为何，今天突然感觉就能接受这种说法。也许上次是信息过载了？

另外，由于没有找到获取PEB结构的api函数，所以尝试在C代码里使用Microsoft C/C++的 __asm 语法内联了汇编代码。

其时还有一个让我疑惑的地方，就是那个sub_40a9a0函数，为什么不直接dll导入方式去调用wcsrchr、_wcsdup、wcslen、MultiByteToWideChar这些函数。而是非要使用GetModuleHandleA以及GetProcAddress函数获取函数指针的方式去调用它们。

之前有些地方也是这样。很奇怪。

----

下午的时候，全贺菁来了。经过全贺菁的一番努力，终于把ReactNative编译通过了。于是我拿到了ShowFabricDetail消息的JSON串。在Unity Editor下调试，找到了出问题的地方。一开始我以为需要改一大片地方。最后其实就只改了两处地方。一个是id、geometryIds由原先的整数变为uuid字符串。一个是PHP后台对空的字典，会从 {} 改为 [] 返回，导致C#代码的(JObject)var 强制类型转换出现InvalidCast异常。需要针对这种情况添加兼容代码。

后面进一步调试，主要是ReactNative那端。看着全贺菁调试。它里面有一个loopTranslate函数，我感觉很危险。这个loopTranslate会递归循环地将一个JSON对象的键名统一调整成camelCase风格。太危险了。那些userProduct、fabricInfo对象，理应是原样提供给Unity端才行。

再晚一些的时候，罗元雷他们的培训课结束了。罗元雷说晚上一起聚餐。于是罗元雷、全贺菁、邱岩岩、杨敏四个一起去了公司边上的大鱼吃小鱼我吃酸菜鱼自助酸菜鱼火锅店。感觉我又吃多了。
